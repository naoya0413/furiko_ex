<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãµã‚Šã“ã®ãã¾ã‚Šå­¦ç¿’ã‚µã‚¤ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // â˜…â˜…â˜… ã“ã®éƒ¨åˆ†ã‚’ã€ã‚ãªãŸã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šæƒ…å ±ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ â˜…â˜…â˜…
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        // â˜…â˜…â˜… ã“ã“ã¾ã§ â˜…â˜…â˜…

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let userId = 'anonymous';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«è¨­å®š
        window.db = db;
        window.auth = auth;
        window.userId = userId;

        // åŒ¿åèªè¨¼ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.userId = user.uid;
                document.getElementById('userIdDisplay').textContent = window.userId;
                console.log("User signed in with UID:", window.userId);
            } else {
                console.log("No user signed in, signing in anonymously...");
                await signInAnonymously(auth);
            }
        });

    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto+Sans+JP', sans-serif;
            background-color: #f0f4f8;
            scroll-behavior: smooth;
        }
        .container {
            max-width: 1000px;
        }
        .section-title {
            position: relative;
            display: inline-block;
            padding-bottom: 8px;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #0d6efd;
            border-radius: 2px;
        }
        .panel {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 24px;
        }
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: #e2e8f0;
            color: #4a5568;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        .tab-button.active {
            background-color: #ffffff;
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
        }
        .chart-container {
            height: 400px;
        }
        .data-table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
        }
        .data-table {
            width: 100%;
            text-align: left;
            border-collapse: collapse;
        }
        .data-table th, .data-table td {
            padding: 8px;
            border: 1px solid #e2e8f0;
        }
        .data-table th {
            background-color: #f7fafc;
        }
        .hidden {
            display: none;
        }
        .stopwatch-container {
            text-align: center;
        }
        .stopwatch-display {
            font-size: 3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }
        .stopwatch-buttons button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 9999px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .stopwatch-buttons .start-stop {
            background-color: #22c55e;
            color: white;
        }
        .stopwatch-buttons .start-stop.stopped {
            background-color: #ef4444;
        }
        .stopwatch-buttons .record {
            background-color: #0d6efd;
            color: white;
        }
        .stopwatch-buttons .reset {
            background-color: #6b7280;
            color: white;
        }
        .experiment-selection {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .experiment-selection button.active {
            background-color: #0d6efd;
            color: white;
        }
        .stopwatch-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <div class="flex items-center justify-between mb-4">
                <div class="text-left text-sm md:text-base font-bold text-gray-700">ç†ç§‘ ï¼—ãµã‚Šã“ã®ãã¾ã‚Š</div>
                <h1 class="text-4xl md:text-5xl font-bold text-[#0d6efd] flex-1 text-center">ãµã‚Šã“ã®ãã¾ã‚Šå­¦ç¿’ã‚µã‚¤ãƒˆ</h1>
            </div>
            <p class="text-lg md:text-xl mt-2 text-gray-600">ã€œã‚­ãƒŸã ã‘ã®ç§‘å­¦è€…ãƒãƒ¼ãƒˆã€œ</p>
            <p class="text-xs text-gray-400 mt-2">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userIdDisplay">èª­ã¿è¾¼ã¿ä¸­...</span></p>
        </header>

        <div id="intro-section" class="panel mb-12">
            <h2 class="section-title text-2xl font-bold mb-4">Step 1: ãµã‚Šã“ã®3ã¤ã®è¦ç´ ã‚’çŸ¥ã‚ã†ï¼</h2>
            <p class="text-base mb-4">ã­ã‡ã€ã¿ã‚“ãªï¼å…¬åœ’ã®ãƒ–ãƒ©ãƒ³ã‚³ã€ã‚‚ã£ã¨é€Ÿãæºã‚‰ã—ãŸã„ã¨æ€ã£ãŸã“ã¨ã¯ãªã„ã‹ãªï¼Ÿä»Šå›ã€ãã®ã²ã¿ã¤ã‚’ç§‘å­¦ã®åŠ›ã§ã¨ã„ã¦ã„ã“ã†ï¼</p>
            
            <div class="flex justify-center mb-8">
                <div class="w-full md:w-3/4 lg:w-2/3 relative" style="padding-bottom: 40%;">
                    <iframe class="absolute top-0 left-0 w-full h-full rounded-lg shadow-lg" src="https://www2.nhk.or.jp/school/watch/clip/?das_id=D0005301841_00000" frameborder="0" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>
            </div>

            <div class="flex flex-col md:flex-row items-start justify-around space-y-4 md:space-y-0 md:space-x-8 mt-8">
                <div class="flex-1 flex flex-col items-center text-center p-4 rounded-lg bg-blue-50">
                    <h3 class="font-bold text-xl text-[#0d6efd] mb-2">ãµã‚Šã“ã®é•·ã•</h3>
                    <div class="rounded-full mx-auto mb-2 w-24 h-24 bg-gray-300 flex items-center justify-center text-4xl font-bold text-white">ğŸ“</div>
                    <p class="text-sm">ãµã‚Šã“ã®ãƒ’ãƒ¢ã‚„é–ã®é•·ã•ã®ã“ã¨ã€‚</p>
                </div>
                <div class="flex-1 flex flex-col items-center text-center p-4 rounded-lg bg-green-50">
                    <h3 class="font-bold text-xl text-[#0d6efd] mb-2">ãŠã‚‚ã‚Šã®é‡ã•</h3>
                    <div class="rounded-full mx-auto mb-2 w-24 h-24 bg-gray-300 flex items-center justify-center text-4xl font-bold text-white">ğŸ‹ï¸</div>
                    <p class="text-sm">ãŠã‚‚ã‚Šï¼ˆãƒ–ãƒ©ãƒ³ã‚³ã«ä¹—ã‚‹äººï¼‰ã®é‡ã•ã®ã“ã¨ã€‚</p>
                </div>
                <div class="flex-1 flex flex-col items-center text-center p-4 rounded-lg bg-yellow-50">
                    <h3 class="font-bold text-xl text-[#0d6efd] mb-2">ãµã‚Œã¯ã°</h3>
                    <div class="rounded-full mx-auto mb-2 w-24 h-24 bg-gray-300 flex items-center justify-center text-4xl font-bold text-white">â†”ï¸</div>
                    <p class="text-sm">ä¸€ç•ªé«˜ã„ã¨ã“ã‚ã‹ã‚‰ä¸€ç•ªä½ã„ã¨ã“ã‚ã¾ã§ã®è·é›¢ã®ã“ã¨ã€‚</p>
                </div>
            </div>
            <p class="mt-8 text-center text-lg font-bold text-gray-700">ã“ã®3ã¤ã®ã†ã¡ã€ã©ã‚Œã‚’å¤‰ãˆã‚Œã°1å¾€å¾©ã™ã‚‹æ™‚é–“ãŒå¤‰ã‚ã‚‹ã¨æ€ã†ï¼Ÿ</p>
        </div>

        <div class="bg-white rounded-t-lg shadow-sm">
            <div role="tablist" class="flex border-b border-gray-200">
                <button id="tab-record-manual" role="tab" aria-selected="true" class="tab-button active">å®Ÿé¨“è¨˜éŒ²ï¼ˆæ‰‹å‹•ï¼‰</button>
                <button id="tab-record-auto" role="tab" aria-selected="false" class="tab-button">å®Ÿé¨“è¨˜éŒ²ï¼ˆè‡ªå‹•ï¼‰</button>
                <button id="tab-simulate" role="tab" aria-selected="false" class="tab-button">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
            </div>
        </div>

        <div id="record-manual-section" class="panel mb-12">
            <h2 class="section-title text-2xl font-bold mb-4">Step 2: å®Ÿé¨“è¨˜éŒ²ã‚’ã¤ã‘ã‚ˆã†ï¼</h2>
            <p class="text-base mb-4">å®Ÿéš›ã«ãµã‚Šã“ã‚’ä½¿ã£ã¦å®Ÿé¨“ã—ã¦ã¿ã‚ˆã†ã€‚**å¤‰ãˆã‚‹æ¡ä»¶ã¯ä¸€ã¤ã ã‘**ã ã‚ˆã€‚å®Ÿé¨“ãŒçµ‚ã‚ã£ãŸã‚‰ã€ã“ã“ã«çµæœã‚’å…¥åŠ›ã—ã¦ã­ã€‚</p>
            
            <div class="bg-gray-50 rounded-lg p-6 flex flex-col items-center">
                <h3 class="text-xl font-bold mb-4">å®Ÿé¨“ã®æ¡ä»¶ã¨çµæœã‚’å…¥åŠ›</h3>
                <div class="w-full space-y-8">
                    <div id="experiment-length-form">
                        <h4 class="font-bold text-lg mb-2 text-[#0d6efd] flex items-center">
                            ãµã‚Šã“ã®é•·ã•ã®å®Ÿé¨“
                            <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">ğŸ“</div>
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="inputLengthExp1" class="block font-medium">ãµã‚Šã“ã®é•·ã• (cm):</label>
                                <input type="range" id="inputLengthExp1" min="25" max="200" step="25" value="100" class="w-full">
                                <span id="lengthValueExp1" class="block text-right mt-1 text-gray-600">100cm</span>
                            </div>
                            <div>
                                <label for="inputTimeExp1" class="block font-medium">10å¾€å¾©ã®æ™‚é–“ (ç§’):</label>
                                <input type="number" id="inputTimeExp1" step="0.01" min="0.01" class="w-full p-2 border rounded-md" placeholder="ä¾‹: 14.28">
                            </div>
                        </div>
                        <div class="mt-4 p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãŠã‚‚ã‚Šã®é‡ã•: 30g, ãµã‚Œã¯ã°: 30Â°</p>
                        </div>
                        <button class="add-result-btn mt-4 bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="length-manual">
                            çµæœã‚’è¨˜éŒ²ã™ã‚‹
                        </button>
                    </div>

                    <hr class="border-gray-300">

                    <div id="experiment-weight-form">
                        <h4 class="font-bold text-lg mb-2 text-[#0d6efd] flex items-center">
                            ãŠã‚‚ã‚Šã®é‡ã•ã®å®Ÿé¨“
                            <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">ğŸ‹ï¸</div>
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="inputWeightExp2" class="block font-medium">ãŠã‚‚ã‚Šã®é‡ã• (g):</label>
                                <input type="range" id="inputWeightExp2" min="10" max="50" step="10" value="10" class="w-full">
                                <span id="weightValueExp2" class="block text-right mt-1 text-gray-600">10g</span>
                            </div>
                            <div>
                                <label for="inputTimeExp2" class="block font-medium">10å¾€å¾©ã®æ™‚é–“ (ç§’):</label>
                                <input type="number" id="inputTimeExp2" step="0.01" min="0.01" class="w-full p-2 border rounded-md" placeholder="ä¾‹: 14.28">
                            </div>
                        </div>
                        <div class="mt-4 p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãµã‚Šã“ã®é•·ã•: 50cm, ãµã‚Œã¯ã°: 30Â°</p>
                        </div>
                        <button class="add-result-btn mt-4 bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="weight-manual">
                            çµæœã‚’è¨˜éŒ²ã™ã‚‹
                        </button>
                    </div>

                    <hr class="border-gray-300">

                    <div id="experiment-amplitude-form">
                        <h4 class="font-bold text-lg mb-2 text-[#0d6efd] flex items-center">
                            ãµã‚Œã¯ã°ã®å®Ÿé¨“
                            <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">â†”ï¸</div>
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="inputAmplitudeExp3" class="block font-medium">ãµã‚Œã¯ã° (åº¦):</label>
                                <input type="range" id="inputAmplitudeExp3" min="10" max="30" step="10" value="10" class="w-full">
                                <span id="amplitudeValueExp3" class="block text-right mt-1 text-gray-600">10Â°</span>
                            </div>
                            <div>
                                <label for="inputTimeExp3" class="block font-medium">10å¾€å¾©ã®æ™‚é–“ (ç§’):</label>
                                <input type="number" id="inputTimeExp3" step="0.01" min="0.01" class="w-full p-2 border rounded-md" placeholder="ä¾‹: 14.28">
                            </div>
                        </div>
                        <div class="mt-4 p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãµã‚Šã“ã®é•·ã•: 50cm, ãŠã‚‚ã‚Šã®é‡ã•: 30g</p>
                        </div>
                        <button class="add-result-btn mt-4 bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="amplitude-manual">
                            çµæœã‚’è¨˜éŒ²ã™ã‚‹
                        </button>
                    </div>
                </div>
                <p id="messageBoxManual" class="mt-4 text-red-500 font-bold hidden"></p>
            </div>
        </div>

        <div id="record-auto-section" class="panel mb-12 hidden">
            <h2 class="section-title text-2xl font-bold mb-4">Step 2: å®Ÿé¨“è¨˜éŒ²ï¼ˆè‡ªå‹•ï¼‰</h2>
            <p class="text-base mb-4">ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã‚’ä½¿ã£ã¦ã€10å¾€å¾©ã®æ™‚é–“ã‚’æ­£ç¢ºã«æ¸¬ã£ã¦ã¿ã‚ˆã†ã€‚**å¤‰ãˆã‚‹æ¡ä»¶ã¯ä¸€ã¤ã ã‘**ã ã‚ˆã€‚</p>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="stopwatch-item">
                    <h3 class="font-bold text-lg mb-4 text-[#0d6efd] flex items-center">
                        <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">ğŸ“</div>
                        ãµã‚Šã“ã®é•·ã•ã®å®Ÿé¨“
                    </h3>
                    <div id="stopwatchDisplayLength" class="stopwatch-display">00:00.00</div>
                    <div class="stopwatch-buttons flex justify-center space-x-4">
                        <button id="stopwatchStartStopLength" class="start-stop">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                    </div>
                    <div class="w-full space-y-4 mt-4">
                        <div>
                            <label for="inputLengthExpAuto1" class="block font-medium text-left">ãµã‚Šã“ã®é•·ã• (cm):</label>
                            <input type="range" id="inputLengthExpAuto1" min="25" max="200" step="25" value="100" class="w-full">
                            <span id="lengthValueExpAuto1" class="block text-right mt-1 text-gray-600">100cm</span>
                        </div>
                        <div class="p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãŠã‚‚ã‚Šã®é‡ã•: 30g, ãµã‚Œã¯ã°: 30Â°</p>
                        </div>
                    </div>
                    <div class="flex justify-start space-x-4 mt-4 hidden" id="auto-buttons-length">
                        <button class="add-result-btn bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="length-auto">
                            è¨˜éŒ²ã™ã‚‹
                        </button>
                        <button class="reset-timer-btn bg-gray-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-700 transition-colors" data-exp-type="length-auto">
                            è¨˜éŒ²ã—ãªã„
                        </button>
                    </div>
                </div>

                <div class="stopwatch-item">
                    <h3 class="font-bold text-lg mb-4 text-[#0d6efd] flex items-center">
                        <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">ğŸ‹ï¸</div>
                        ãŠã‚‚ã‚Šã®é‡ã•ã®å®Ÿé¨“
                    </h3>
                    <div id="stopwatchDisplayWeight" class="stopwatch-display">00:00.00</div>
                    <div class="stopwatch-buttons flex justify-center space-x-4">
                        <button id="stopwatchStartStopWeight" class="start-stop">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                    </div>
                    <div class="w-full space-y-4 mt-4">
                        <div>
                            <label for="inputWeightExpAuto2" class="block font-medium text-left">ãŠã‚‚ã‚Šã®é‡ã• (g):</label>
                            <input type="range" id="inputWeightExpAuto2" min="10" max="50" step="10" value="10" class="w-full">
                            <span id="weightValueExpAuto2" class="block text-right mt-1 text-gray-600">10g</span>
                        </div>
                        <div class="p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãµã‚Šã“ã®é•·ã•: 50cm, ãµã‚Œã¯ã°: 30Â°</p>
                        </div>
                    </div>
                    <div class="flex justify-start space-x-4 mt-4 hidden" id="auto-buttons-weight">
                        <button class="add-result-btn bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="weight-auto">
                            è¨˜éŒ²ã™ã‚‹
                        </button>
                        <button class="reset-timer-btn bg-gray-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-700 transition-colors" data-exp-type="weight-auto">
                            è¨˜éŒ²ã—ãªã„
                        </button>
                    </div>
                </div>

                <div class="stopwatch-item">
                    <h3 class="font-bold text-lg mb-4 text-[#0d6efd] flex items-center">
                        <div class="rounded-full ml-4 w-12 h-12 bg-gray-300 flex items-center justify-center text-xl font-bold text-white">â†”ï¸</div>
                        ãµã‚Œã¯ã°ã®å®Ÿé¨“
                    </h3>
                    <div id="stopwatchDisplayAmplitude" class="stopwatch-display">00:00.00</div>
                    <div class="stopwatch-buttons flex justify-center space-x-4">
                        <button id="stopwatchStartStopAmplitude" class="start-stop">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                    </div>
                    <div class="w-full space-y-4 mt-4">
                        <div>
                            <label for="inputAmplitudeExpAuto3" class="block font-medium text-left">ãµã‚Œã¯ã° (åº¦):</label>
                            <input type="range" id="inputAmplitudeExpAuto3" min="10" max="30" step="10" value="10" class="w-full">
                            <span id="amplitudeValueExpAuto3" class="block text-right mt-1 text-gray-600">10Â°</span>
                        </div>
                        <div class="p-2 bg-blue-100 rounded-md">
                            <p class="text-sm font-semibold">ã€æƒãˆã‚‹æ¡ä»¶ã€‘ãµã‚Šã“ã®é•·ã•: 50cm, ãŠã‚‚ã‚Šã®é‡ã•: 30g</p>
                        </div>
                    </div>
                    <div class="flex justify-start space-x-4 mt-4 hidden" id="auto-buttons-amplitude">
                        <button class="add-result-btn bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors" data-exp-type="amplitude-auto">
                            è¨˜éŒ²ã™ã‚‹
                        </button>
                        <button class="reset-timer-btn bg-gray-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-700 transition-colors" data-exp-type="amplitude-auto">
                            è¨˜éŒ²ã—ãªã„
                        </button>
                    </div>
                </div>
            </div>
            
            <p id="messageBoxAuto" class="mt-4 text-red-500 font-bold hidden"></p>
            
            <hr class="my-8 border-gray-300">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">é•·ã•ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="lengthChartAuto"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="lengthTableAuto">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">é•·ã• (cm)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">é‡ã•ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="weightChartAuto"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="weightTableAuto">
                             <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">é‡ã• (g)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">ãµã‚Œã¯ã°ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="amplitudeChartAuto"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="amplitudeTableAuto">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">ãµã‚Œã¯ã° (åº¦)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="simulation-section" class="panel mb-12 hidden">
            <h2 class="section-title text-2xl font-bold mb-4">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šäºˆæƒ³ã‚’ç¢ºã‹ã‚ã‚ˆã†ï¼</h2>
            <p class="text-base mb-4">ã“ã“ã§ã¯ã€ãµã‚Šã“ã®å‹•ãã‚’ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§å†ç¾ã§ãã‚‹ã‚ˆã€‚å›ã®äºˆæƒ³ã¨æ¯”ã¹ã¦ã¿ã‚ˆã†ã€‚</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 rounded-lg p-6 flex flex-col items-center">
                    <h3 class="text-xl font-bold mb-4">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¡ä»¶ã‚’æ±ºã‚ã‚ˆã†</h3>
                    <div class="w-full space-y-4">
                        <div>
                            <label for="simLength" class="block font-medium">ãµã‚Šã“ã®é•·ã• (cm):</label>
                            <input type="range" id="simLength" min="25" max="200" step="25" value="100" class="w-full">
                            <span id="simLengthValue" class="block text-right mt-1">100cm</span>
                        </div>
                        <div>
                            <label for="simWeight" class="block font-medium">ãŠã‚‚ã‚Šã®é‡ã• (g):</label>
                            <input type="range" id="simWeight" min="10" max="50" step="10" value="10" class="w-full">
                            <span id="simWeightValue" class="block text-right mt-1">10g</span>
                        </div>
                        <div>
                            <label for="simAmplitude" class="block font-medium">ãµã‚Œã¯ã° (åº¦):</label>
                            <input type="range" id="simAmplitude" min="10" max="30" step="10" value="10" class="w-full">
                            <span id="simAmplitudeValue" class="block text-right mt-1">10Â°</span>
                        </div>
                    </div>
                    <button id="startSimBtn" class="mt-8 bg-[#0d6efd] text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors">
                        ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-6 flex flex-col items-center">
                    <h3 class="text-xl font-bold mb-4">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
                    <canvas id="pendulumCanvas" class="w-full" height="300"></canvas>
                    <p id="timerDisplay" class="text-2xl font-bold mt-4">0.00 ç§’</p>
                </div>
            </div>
        </div>

        <div id="data-section-manual" class="panel mb-12">
            <h2 class="section-title text-2xl font-bold mb-4">Step 3: ãƒ‡ãƒ¼ã‚¿ã¨è€ƒå¯Ÿã§ã¾ã¨ã‚ã‚ˆã†ï¼</h2>
            <p class="text-base mb-4">å®Ÿé¨“ã§é›†ã‚ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«è¨˜éŒ²ã—ã¦ã„ã“ã†ã€‚ã‚°ãƒ©ãƒ•ã«ã™ã‚‹ã¨ã€ã‚‚ã£ã¨åˆ†ã‹ã‚Šã‚„ã™ããªã‚‹ã‚ˆï¼</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">é•·ã•ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="lengthChart"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="lengthTable">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">é•·ã• (cm)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">é‡ã•ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="weightChart"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="weightTable">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">é‡ã• (g)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                 <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-lg font-bold text-center mb-4">ãµã‚Œã¯ã°ã¨1å¾€å¾©ã®æ™‚é–“ã®é–¢ä¿‚</h3>
                    <div class="chart-container">
                        <canvas id="amplitudeChart"></canvas>
                    </div>
                    <div class="data-table-container">
                        <table class="data-table" id="amplitudeTable">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th rowspan="2" class="px-4 py-2 text-center align-middle">ãµã‚Œã¯ã° (åº¦)</th>
                                    <th colspan="3" class="px-2 py-2 text-center">10å¾€å¾©ã™ã‚‹æ™‚é–“ (ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">åˆè¨ˆ(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">å¹³å‡(ç§’)</th>
                                    <th rowspan="2" class="px-2 py-2 text-center align-middle">1å¾€å¾©å¹³å‡(ç§’)</th>
                                </tr>
                                <tr class="bg-gray-100">
                                    <th class="px-4 py-2 text-center">1å›ç›®</th>
                                    <th class="px-4 py-2 text-center">2å›ç›®</th>
                                    <th class="px-4 py-2 text-center">3å›ç›®</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
    <script>
    // ====== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ======
    let pendulumLengthChart, pendulumWeightChart, pendulumAmplitudeChart;
    let autoLengthChart, autoWeightChart, autoAmplitudeChart;

    const dataCache = {
        'length-manual': [],
        'weight-manual': [],
        'amplitude-manual': [],
        'length-auto': {},
        'weight-auto': {},
        'amplitude-auto': {},
    };

    // ====== åˆæœŸåŒ–å‡¦ç† ======
    document.addEventListener('DOMContentLoaded', () => {
        setupTabs();
        setupInputListeners();
        setupRecordButtons();
        setupStopwatches();
        setupCharts();
        setupSimulation();
        loadDataFromFirestore();
    });

    // ====== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ======
    function setupTabs() {
        const tabs = document.querySelectorAll('.tab-button');
        const sections = {
            'tab-record-manual': 'record-manual-section',
            'tab-record-auto': 'record-auto-section',
            'tab-simulate': 'simulation-section'
        };

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‹ã‚‰'active'ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                tabs.forEach(t => t.classList.remove('active'));
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ãƒ–ã«'active'ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                tab.classList.add('active');

                // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                for (const key in sections) {
                    document.getElementById(sections[key]).classList.add('hidden');
                }

                // é¸æŠã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
                document.getElementById(sections[tab.id]).classList.remove('hidden');

                // 'å®Ÿé¨“è¨˜éŒ²ï¼ˆæ‰‹å‹•ï¼‰'ã‚¿ãƒ–é¸æŠæ™‚ã®ç‰¹åˆ¥å‡¦ç†
                const dataSectionManual = document.getElementById('data-section-manual');
                const dataSectionAuto = document.getElementById('record-auto-section').querySelector('.grid-cols-3.gap-6.mt-8');
                
                if (tab.id === 'tab-record-manual') {
                    dataSectionManual.classList.remove('hidden');
                    dataSectionAuto.classList.add('hidden');
                } else if (tab.id === 'tab-record-auto') {
                    dataSectionManual.classList.add('hidden');
                    dataSectionAuto.classList.remove('hidden');
                } else {
                    dataSectionManual.classList.add('hidden');
                    dataSectionAuto.classList.add('hidden');
                }
            });
        });
    }


    // ====== å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒªã‚¹ãƒŠãƒ¼è¨­å®š ======
    function setupInputListeners() {
        document.getElementById('inputLengthExp1').addEventListener('input', (e) => {
            document.getElementById('lengthValueExp1').textContent = `${e.target.value}cm`;
        });
        document.getElementById('inputWeightExp2').addEventListener('input', (e) => {
            document.getElementById('weightValueExp2').textContent = `${e.target.value}g`;
        });
        document.getElementById('inputAmplitudeExp3').addEventListener('input', (e) => {
            document.getElementById('amplitudeValueExp3').textContent = `${e.target.value}Â°`;
        });
        document.getElementById('inputLengthExpAuto1').addEventListener('input', (e) => {
            document.getElementById('lengthValueExpAuto1').textContent = `${e.target.value}cm`;
        });
        document.getElementById('inputWeightExpAuto2').addEventListener('input', (e) => {
            document.getElementById('weightValueExpAuto2').textContent = `${e.target.value}g`;
        });
        document.getElementById('inputAmplitudeExpAuto3').addEventListener('input', (e) => {
            document.getElementById('amplitudeValueExpAuto3').textContent = `${e.target.value}Â°`;
        });
        document.getElementById('simLength').addEventListener('input', (e) => {
            document.getElementById('simLengthValue').textContent = `${e.target.value}cm`;
        });
        document.getElementById('simWeight').addEventListener('input', (e) => {
            document.getElementById('simWeightValue').textContent = `${e.target.value}g`;
        });
        document.getElementById('simAmplitude').addEventListener('input', (e) => {
            document.getElementById('simAmplitudeValue').textContent = `${e.target.value}Â°`;
        });
    }

    // ====== è¨˜éŒ²ãƒœã‚¿ãƒ³æ©Ÿèƒ½ ======
    function setupRecordButtons() {
        document.querySelectorAll('.add-result-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const type = e.target.dataset.expType;
                let data = {};
                let messageBoxId;
                let docId;

                switch (type) {
                    case 'length-manual':
                        data.length = parseInt(document.getElementById('inputLengthExp1').value);
                        data.time = parseFloat(document.getElementById('inputTimeExp1').value);
                        data.type = 'length';
                        messageBoxId = 'messageBoxManual';
                        docId = `${data.length}`;
                        break;
                    case 'weight-manual':
                        data.weight = parseInt(document.getElementById('inputWeightExp2').value);
                        data.time = parseFloat(document.getElementById('inputTimeExp2').value);
                        data.type = 'weight';
                        messageBoxId = 'messageBoxManual';
                        docId = `${data.weight}`;
                        break;
                    case 'amplitude-manual':
                        data.amplitude = parseInt(document.getElementById('inputAmplitudeExp3').value);
                        data.time = parseFloat(document.getElementById('inputTimeExp3').value);
                        data.type = 'amplitude';
                        messageBoxId = 'messageBoxManual';
                        docId = `${data.amplitude}`;
                        break;
                    case 'length-auto':
                        data.length = parseInt(document.getElementById('inputLengthExpAuto1').value);
                        data.time = window.stopwatchLengthTime;
                        data.type = 'length';
                        messageBoxId = 'messageBoxAuto';
                        docId = `${data.length}`;
                        break;
                    case 'weight-auto':
                        data.weight = parseInt(document.getElementById('inputWeightExpAuto2').value);
                        data.time = window.stopwatchWeightTime;
                        data.type = 'weight';
                        messageBoxId = 'messageBoxAuto';
                        docId = `${data.weight}`;
                        break;
                    case 'amplitude-auto':
                        data.amplitude = parseInt(document.getElementById('inputAmplitudeExpAuto3').value);
                        data.time = window.stopwatchAmplitudeTime;
                        data.type = 'amplitude';
                        messageBoxId = 'messageBoxAuto';
                        docId = `${data.amplitude}`;
                        break;
                }

                if (data.time === undefined || isNaN(data.time)) {
                    showMessage(messageBoxId, 'æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'red');
                    return;
                }

                if (window.userId === 'anonymous') {
                    showMessage(messageBoxId, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚', 'red');
                    return;
                }

                const collectionName = `${window.userId}-${type}`;
                const docRef = doc(db, collectionName, docId);

                try {
                    const existingDoc = await getDocs(query(collection(db, collectionName)));
                    let currentData = null;
                    existingDoc.forEach(d => {
                        if(d.id === docId) {
                            currentData = d.data();
                        }
                    });

                    let times = currentData && currentData.times ? currentData.times : [];
                    times.push(data.time);

                    await setDoc(docRef, {
                        param: data.length || data.weight || data.amplitude,
                        times: times,
                        timestamp: new Date()
                    });

                    showMessage(messageBoxId, 'è¨˜éŒ²ã—ã¾ã—ãŸï¼', 'green');
                } catch (error) {
                    console.error("Error writing document: ", error);
                    showMessage(messageBoxId, 'è¨˜éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'red');
                }
            });
        });
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ©Ÿèƒ½
    function showMessage(id, message, type) {
        const box = document.getElementById(id);
        box.textContent = message;
        box.classList.remove('hidden', 'text-red-500', 'text-green-500');
        box.classList.add(`text-${type}-500`);
        setTimeout(() => box.classList.add('hidden'), 3000);
    }

    // ====== Firebaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦æç”» ======
    function loadDataFromFirestore() {
        if (window.userId === 'anonymous') {
            setTimeout(loadDataFromFirestore, 500); // èªè¨¼ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿ
            return;
        }

        const expTypes = ['length', 'weight', 'amplitude'];

        expTypes.forEach(type => {
            // æ‰‹å‹•ã‚¿ãƒ–ç”¨
            const manualCollectionName = `${window.userId}-${type}-manual`;
            onSnapshot(collection(db, manualCollectionName), (snapshot) => {
                const data = [];
                snapshot.forEach(doc => data.push(doc.data()));
                updateTableAndChart(data, type, false);
            });

            // è‡ªå‹•ã‚¿ãƒ–ç”¨
            const autoCollectionName = `${window.userId}-${type}-auto`;
            onSnapshot(collection(db, autoCollectionName), (snapshot) => {
                const data = [];
                snapshot.forEach(doc => data.push(doc.data()));
                updateTableAndChart(data, type, true);
            });
        });
    }

    // ====== ã‚°ãƒ©ãƒ•ã¨è¡¨ã®æ›´æ–° ======
    function updateTableAndChart(data, type, isAuto) {
        const sortedData = data.sort((a, b) => a.param - b.param);

        const tableId = `${type}Table${isAuto ? 'Auto' : ''}`;
        const chartId = `${type}Chart${isAuto ? 'Auto' : ''}`;
        const tableBody = document.getElementById(tableId).querySelector('tbody');
        const chart = isAuto ? getChartInstance(chartId, type, true) : getChartInstance(chartId, type, false);

        tableBody.innerHTML = ''; // è¡¨ã‚’ã‚¯ãƒªã‚¢

        const labels = [];
        const chartData = [];

        sortedData.forEach(item => {
            const param = item.param;
            const times = item.times;
            const totalTime = times.reduce((sum, current) => sum + current, 0);
            const averageTime = totalTime / times.length;
            const oneRoundTime = averageTime / 10;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-4 py-2 text-center font-bold">${param}</td>
                <td class="px-4 py-2 text-center">${times[0] ? times[0].toFixed(2) : '-'}</td>
                <td class="px-4 py-2 text-center">${times[1] ? times[1].toFixed(2) : '-'}</td>
                <td class="px-4 py-2 text-center">${times[2] ? times[2].toFixed(2) : '-'}</td>
                <td class="px-4 py-2 text-center">${totalTime.toFixed(2)}</td>
                <td class="px-4 py-2 text-center">${averageTime.toFixed(2)}</td>
                <td class="px-4 py-2 text-center">${oneRoundTime.toFixed(2)}</td>
            `;
            tableBody.appendChild(row);

            labels.push(param);
            chartData.push(oneRoundTime);
        });

        chart.data.labels = labels;
        chart.data.datasets[0].data = chartData;
        chart.update();
    }


    // ====== ã‚°ãƒ©ãƒ•ã®åˆæœŸåŒ– ======
    function setupCharts() {
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '1å¾€å¾©ã®æ™‚é–“ (ç§’)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿'
                    }
                }
            }
        };

        const ctxLength = document.getElementById('lengthChart').getContext('2d');
        const ctxWeight = document.getElementById('weightChart').getContext('2d');
        const ctxAmplitude = document.getElementById('amplitudeChart').getContext('2d');
        const ctxLengthAuto = document.getElementById('lengthChartAuto').getContext('2d');
        const ctxWeightAuto = document.getElementById('weightChartAuto').getContext('2d');
        const ctxAmplitudeAuto = document.getElementById('amplitudeChartAuto').getContext('2d');

        chartOptions.scales.x.title.text = 'ãµã‚Šã“ã®é•·ã• (cm)';
        pendulumLengthChart = new Chart(ctxLength, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(75, 192, 192)', tension: 0.1 }] }, options: chartOptions
        });
        autoLengthChart = new Chart(ctxLengthAuto, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(75, 192, 192)', tension: 0.1 }] }, options: chartOptions
        });

        chartOptions.scales.x.title.text = 'ãŠã‚‚ã‚Šã®é‡ã• (g)';
        pendulumWeightChart = new Chart(ctxWeight, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(255, 99, 132)', tension: 0.1 }] }, options: chartOptions
        });
        autoWeightChart = new Chart(ctxWeightAuto, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(255, 99, 132)', tension: 0.1 }] }, options: chartOptions
        });

        chartOptions.scales.x.title.text = 'ãµã‚Œã¯ã° (åº¦)';
        pendulumAmplitudeChart = new Chart(ctxAmplitude, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(54, 162, 235)', tension: 0.1 }] }, options: chartOptions
        });
        autoAmplitudeChart = new Chart(ctxAmplitudeAuto, {
            type: 'line', data: { labels: [], datasets: [{ label: '1å¾€å¾©ã®æ™‚é–“', data: [], borderColor: 'rgb(54, 162, 235)', tension: 0.1 }] }, options: chartOptions
        });
    }

    function getChartInstance(id, type, isAuto) {
        if (id === 'lengthChart') return pendulumLengthChart;
        if (id === 'weightChart') return pendulumWeightChart;
        if (id === 'amplitudeChart') return pendulumAmplitudeChart;
        if (id === 'lengthChartAuto') return autoLengthChart;
        if (id === 'weightChartAuto') return autoWeightChart;
        if (id === 'amplitudeChartAuto') return autoAmplitudeChart;
    }

    // ====== ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒæ©Ÿèƒ½ ======
    let stopwatchLengthInterval, stopwatchWeightInterval, stopwatchAmplitudeInterval;
    let stopwatchLengthStartTime, stopwatchWeightStartTime, stopwatchAmplitudeStartTime;
    window.stopwatchLengthTime, window.stopwatchWeightTime, window.stopwatchAmplitudeTime;

    function setupStopwatches() {
        document.getElementById('stopwatchStartStopLength').addEventListener('click', () => toggleStopwatch('length'));
        document.getElementById('stopwatchStartStopWeight').addEventListener('click', () => toggleStopwatch('weight'));
        document.getElementById('stopwatchStartStopAmplitude').addEventListener('click', () => toggleStopwatch('amplitude'));
        document.querySelectorAll('.reset-timer-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const type = e.target.dataset.expType.replace('-auto', '');
                resetStopwatch(type);
            });
        });
    }

    function toggleStopwatch(type) {
        const display = document.getElementById(`stopwatchDisplay${capitalize(type)}`);
        const button = document.getElementById(`stopwatchStartStop${capitalize(type)}`);
        const buttonsContainer = document.getElementById(`auto-buttons-${type}`);

        if (button.textContent === 'ã‚¹ã‚¿ãƒ¼ãƒˆ') {
            const now = Date.now();
            if (type === 'length') {
                stopwatchLengthStartTime = now;
                stopwatchLengthInterval = setInterval(() => {
                    const elapsed = Date.now() - stopwatchLengthStartTime;
                    window.stopwatchLengthTime = elapsed / 1000;
                    display.textContent = formatTime(elapsed);
                }, 10);
            } else if (type === 'weight') {
                stopwatchWeightStartTime = now;
                stopwatchWeightInterval = setInterval(() => {
                    const elapsed = Date.now() - stopwatchWeightStartTime;
                    window.stopwatchWeightTime = elapsed / 1000;
                    display.textContent = formatTime(elapsed);
                }, 10);
            } else if (type === 'amplitude') {
                stopwatchAmplitudeStartTime = now;
                stopwatchAmplitudeInterval = setInterval(() => {
                    const elapsed = Date.now() - stopwatchAmplitudeStartTime;
                    window.stopwatchAmplitudeTime = elapsed / 1000;
                    display.textContent = formatTime(elapsed);
                }, 10);
            }

            button.textContent = 'ã‚¹ãƒˆãƒƒãƒ—';
            button.classList.add('stopped');
            buttonsContainer.classList.add('hidden');
        } else {
            if (type === 'length') clearInterval(stopwatchLengthInterval);
            if (type === 'weight') clearInterval(stopwatchWeightInterval);
            if (type === 'amplitude') clearInterval(stopwatchAmplitudeInterval);

            button.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
            button.classList.remove('stopped');
            buttonsContainer.classList.remove('hidden');
        }
    }

    function resetStopwatch(type) {
        const display = document.getElementById(`stopwatchDisplay${capitalize(type)}`);
        const buttonsContainer = document.getElementById(`auto-buttons-${type}`);
        display.textContent = '00:00.00';
        buttonsContainer.classList.add('hidden');
    }

    function formatTime(ms) {
        const minutes = Math.floor(ms / 60000);
        const seconds = Math.floor((ms % 60000) / 1000);
        const milliseconds = Math.floor((ms % 1000) / 10);
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(2, '0')}`;
    }

    function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
    
    // ====== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ ======
    function setupSimulation() {
        const canvas = document.getElementById('pendulumCanvas');
        const ctx = canvas.getContext('2d');
        const timerDisplay = document.getElementById('timerDisplay');
        const startSimBtn = document.getElementById('startSimBtn');

        let animationFrameId = null;
        let startTime = null;

        startSimBtn.addEventListener('click', () => {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                startSimBtn.textContent = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼';
                return;
            }

            const length = parseInt(document.getElementById('simLength').value);
            const amplitude = parseInt(document.getElementById('simAmplitude').value);
            // é‡ã•ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã—ãªã„ãŸã‚ã€ã“ã“ã§ã¯ä½¿ç”¨ã—ãªã„
            
            const g = 9.81; // é‡åŠ›åŠ é€Ÿåº¦ (m/s^2)
            const L = length / 100; // é•·ã•ã‚’ãƒ¡ãƒ¼ãƒˆãƒ«ã«å¤‰æ›
            const initialAngle = amplitude * Math.PI / 180; // è§’åº¦ã‚’ãƒ©ã‚¸ã‚¢ãƒ³ã«å¤‰æ›
            const T = 2 * Math.PI * Math.sqrt(L / g); // ç†è«–ä¸Šã®å‘¨æœŸ (ç§’)
            const omega = Math.sqrt(g / L); // è§’æŒ¯å‹•æ•°

            let angle = initialAngle;
            let lastTime = performance.now();
            let elapsedTime = 0;
            startTime = performance.now();

            function drawPendulum() {
                const now = performance.now();
                const deltaTime = (now - lastTime) / 1000;
                lastTime = now;
                elapsedTime += deltaTime;

                // å˜æŒ¯å‹•ã®è¿‘ä¼¼å¼ã§è§’åº¦ã‚’è¨ˆç®—
                angle = initialAngle * Math.cos(omega * elapsedTime);
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ä¸­å¿ƒç‚¹ (å›ºå®šç‚¹)
                const originX = canvas.width / 2;
                const originY = 20;

                // ãµã‚Šã“ã®ç‰ã®ä½ç½®ã‚’è¨ˆç®—
                const x = originX + L * 300 * Math.sin(angle); // 300ã¯æç”»ã®ãŸã‚ã®ã‚¹ã‚±ãƒ¼ãƒ«
                const y = originY + L * 300 * Math.cos(angle);

                // æç”»
                ctx.beginPath();
                ctx.moveTo(originX, originY);
                ctx.lineTo(x, y);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#6c757d';
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, 2 * Math.PI);
                ctx.fillStyle = '#0d6efd';
                ctx.fill();

                // ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
                const currentSimTime = (performance.now() - startTime) / 1000;
                timerDisplay.textContent = `${currentSimTime.toFixed(2)} ç§’`;

                animationFrameId = requestAnimationFrame(drawPendulum);
            }

            drawPendulum();
            startSimBtn.textContent = 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢';
        });
    }

    </script>
</body>
</html>
